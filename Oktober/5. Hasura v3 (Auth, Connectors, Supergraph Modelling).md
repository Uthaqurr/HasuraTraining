# HASURA v3 (DDN) (AUTH, CONNECTORS, SUPERGRAPH MODELLING)


## 1. AUTH

### Overview

Hasura memberikan kemampuan untuk mengautentikasi pengguna sesuai dengan keinginannya, terintegrasi dengan berbagai layanan autentikasi yang populer ataupun solusi untuk kustomisasi dari hosting yang digunakan di tempat lain.
 

### Authentication

**1.Introduction**

Hasura DDN menggunakan variabel sesi, dengan pengguna, peran, organisasi, dan informasi lain yang spesifik yang mungkin diperlukan untuk menentukan hak akses data pengguna.

Dengan variabel sesi ini, pengguna dapat menentukan aturan izin pada domain data untuk menyediakan kontrol akses yang terperinci ke sumber daya.

Hasura tidak memihak pada layanan autentikasi. Hasura mendelegasikan tanggung jawab pembuatan variabel sesi ke layanan autentikasi baru atau yang sudah ada, sehingga memberikan fleksibilitas dan rentang opsi terbesar untuk kebutuhan autentikasi.

Autentikasi dapat dikonfigurasi melalui token web JSON (JWT) atau layanan webhook dan dapat diintegrasikan dengan penyedia mana pun yang digunakan (misalnya, Auth0, Firebase Auth, AWS Cognito, solusi khusus, dll.) untuk memverifikasi pengguna dan menetapkan variabel sesi yang kemudian mengontrol akses ke data.


**2.JWT**


* LANGKAH 1.Memperbarui AuthConfig

![image](https://github.com/user-attachments/assets/78162b32-11cb-47a6-8e7a-76d379c8034d)

## *1.Mengaktifkan Autentikasi JWT*

* LANGKAH 1 Buatlah file dengan direktori *global/metadata/auth-config.hml*

```
kind: AuthConfig
version: v2
definition:
  mode:
    jwt:
      claimsConfig:
        namespace:
          claimsFormat: Json
          location: /claims.jwt.hasura.io
      tokenLocation:
        type: BearerAuthorization
      key:
        jwkFromUrl: "https://your-jwk-url.your-service.com"
  ```

* LANGKAH 2.Membuat Klaim

  Layanan autentikasi harus menyertakan objek dengan kunci https://hasura.io/jwt/claims dalam klaim JWT. Di dalamnya, setiap klaim harus diawali dengan x-hasura-* dan        menyertakan informasi yang relevan.

  ![image](https://github.com/user-attachments/assets/0b6c8549-fd73-4b9c-8a7e-794f4a1eca30)

  Sebagai contoh, kami menyertakan klaim yang diperlukan dengan menyatakan peran default adalah pengguna dan daftar peran yang tersedia terbatas pada pengguna dan admin.     Selain itu, kami meneruskan kunci atau key khusus x-hasura-user-id yang dapat digunakan dengan izin saat menjalankan kueri.

```
{
  "sub": "1234567890",
  "name": "John Doe",
  "admin": false,
  "iat": 1516239022,
  "exp": 1516325422,
  "claims.jwt.hasura.io": {
    "x-hasura-default-role": "user",
    "x-hasura-allowed-roles": ["user", "admin"],
    "x-hasura-user-id": "1234"
  }
}
  ```

* LANGKAH 3.Membangun Ulang Supergraph

  Setelah memperbarui auth-config.hml dan memperbarui klaim , Selanjutnya dapat membangun kembali supergraf dan mengujinya secara lokal.


```
ddn supergraph build local \
  --supergraph supergraph.yaml \
  --env-file .env
```


* LANGKAH 4.Membuat Permintaan Terautentikasi

  Dalam contoh di atas, kami menggunakan metode BearerAuthorization. Dengan demikian, kami dapat membuat permintaan ke instans Hasura DDN dengan menyertakan header dengan nilai kunci Authorization: Bearer <our-encoded-token>. Untuk pengujian, pengguna dapat meneruskan nilai ini di bagian header konsol Hasura DDN.


## *2.Providers*

Hasura dirancang untuk terintegrasi dengan penyedia JWT mana pun, termasuk server autentikasi yang dibuat sendiri. Di bawah ini, akan disebutkan tautan ke beberapa resep yang kami miliki untuk menghubungkan penyedia populer dengan cepat dengan proyek Hasura DDN.


* [Auth0](https://hasura.io/docs/3.0/recipes/authentication/auth0)
* [AWS Cognito](https://hasura.io/docs/3.0/recipes/authentication/aws-cognito)
* [Firebase](https://hasura.io/docs/3.0/recipes/authentication/firebase)
* [Clerk](https://hasura.io/docs/3.0/recipes/authentication/clerk)


## *3.Mempersiapkan JWT untuk Pengujian*

* Langkah 1. Memasang JWT-CLI

  Instal jwt-cli, yang memungkinkan untuk membuat token dari baris perintah.Disini pengguna dapat mengikuti daftar petunjuk instalasi yang terdapat [di sini](https://github.com/mike-engel/jwt-cli?tab=readme-ov-file#installation).
  

* Langkah 2. Menghasilkan String Acak

   ```
   openssl rand -hex 16
   ```


* Langkah 3. Mempersiapkan Authconfig Object

```
kind: AuthConfig
version: v2
definition:
  mode:
    jwt:
      claimsConfig:
        namespace:
          claimsFormat: Json
          location: "/claims.jwt.hasura.io"
      key:
        fixed:
          algorithm: HS256
          key:
            value: "<insert-the-key-generated-in-previous-step>"
      tokenLocation:
        type: Header
        name: Auth-Token

  ```

* Langkah 4. Membuat Supergraph Build Baru

  ```
  ddn supergraph build create \
  --description "use jwt-based authconfig" \
  --supergraph supergraph.yaml
  ```

* Langkah 5. Menghasilkan JWT

  ```
  jwt encode --secret="<secret-key>" '{"exp": 1739905122,"iat": 1708369122,"claims.jwt.hasura.io":{"x-hasura-default-role": "admin","x-hasura-allowed-roles":["admin"]}}'
  ```

  
* Langkah 6. Uji Authconfig

  Di konsol Hasura, tambahkan JWT yang dihasilkan oleh konsol sebagai nilai header baru yang disebut Auth-token pada penjelajah GraphiQL. Sekarang pengguna dapat            menjalankan kueri dengan JWT kustom yang sudah dibuat.
  

**3.WEBHOOK**

## *1.Mengaktifkan Autentikasi Webhook*

* Langkah 1. Membentuk request dan respons webhook

  #### 1.REQUEST
  
  webhook harus menerima permintaan GET atau POST. Berikut adalah contoh header permintaan yang mungkin diproses oleh webhook Anda:

  ```
  {
  "headers": {
    "Authorization": "Bearer some-token",
    "Content-Type": "application/json"
  }
    }
  
  ```

  #### 2.PARSING

  #### 3.RESPONS
  
* Langkah 2. Memperbaharui Authconfig
* Langkah 3. Membangun Ulang Supergraph
* Langkah 4. Membuat request yang di autentikasi
